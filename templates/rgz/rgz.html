{% extends 'base.html' %}

{% block lab %}РГЗ{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='rgz/main.js')}}"></script>
<script>
function renderMenu() {
    const menu = document.getElementById("menu");
    
    menu.innerHTML = `
        {% if session.get('user_id') %}
            <button class="menu-btn" onclick="showAddForm()">Добавить сотрудника</button>
            <button class="menu-btn" onclick="logoutUser()">Выйти</button>
            <button class="menu-btn" onclick="confirmDeleteAccount()">Удалить аккаунт</button>
        {% else %}
            <a href="/rgz/login" class="menu-btn">Войти</a>
            <a href="/rgz/register" class="menu-btn">Регистрация</a>
        {% endif %}
    `;
}

function showAddForm() {
    document.getElementById('id').value = '';
    document.getElementById('full_name').value = '';
    document.getElementById('position').value = '';
    document.getElementById('gender').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('email').value = '';
    document.getElementById('trial').value = '';
    document.getElementById('hire_date').value = '';
    
    document.getElementById('fullname-error').innerText = '';
    document.getElementById('position-error').innerText = '';
    document.getElementById('gender-error').innerText = '';
    document.getElementById('phone-error').innerText = '';
    document.getElementById('email-error').innerText = '';
    document.getElementById('trial-error').innerText = '';
    document.getElementById('hire-date-error').innerText = '';
    
    showModal();
}
</script>
{% endblock %}

{% block style%}
<style>
.error {
    color: #cc0000;
    background-color: #ffe6e6;
    border: 1px solid #ffcccc;
    padding: 12px;
    margin-top: 10px;
    border-radius: 6px;
    text-align: center;
    display: none;
}

.error:not(:empty) {
    display: block;
}
</style>
<link rel="stylesheet" href="{{ url_for('static', filename='rgz/main.css')}}">
{% endblock %}

{% block main %}
<div class="menu" id="menu">
</div>
<script>
    renderMenu();
</script>

<h1>Добро пожаловать в систему отдела кадров</h1>

<input type="text" id="search-input" placeholder="Поиск..." oninput="searchEmployees()">

<button onclick="sortBy('full_name')">Сортировать по ФИО</button>
<button onclick="sortBy('position')">Сортировать по должности</button>
<button onclick="sortBy('email')">Сортировать по email</button>

<table>
    <thead>
        <tr>
            <th>ФИО</th>
            <th>Должность</th>
            <th>E-mail</th>
        </tr>
    </thead>
    <tbody id="employee-list">
    </tbody>
</table>
<script>
    fillEmployeeList();
</script>

<button id="load-more-btn" onclick="showMore()">Показать ещё</button>

<div class="modal">
    <div style="background:#fff; padding:20px; border-radius:10px; width:400px; position:relative;">
        <h2>Сотрудник</h2>
        <input type="hidden" id="id">

        <label>ФИО: <input type="text" id="full_name"></label>
        <div id="fullname-error" class="error"></div>

        <label>Должность: <input type="text" id="position"></label>
        <div id="position-error" class="error"></div>

        <label>Пол: 
            <select id="gender">
                <option value="М">Мужской</option>
                <option value="Ж">Женский</option>
            </select>
        </label>
        <div id="gender-error" class="error"></div>

        <label>Телефон: <input type="text" id="phone"></label>
        <div id="phone-error" class="error"></div>

        <label>Email: <input type="text" id="email"></label>
        <div id="email-error" class="error"></div>

        <label>Испытательный срок: 
            <select id="trial">
                <option value="1">Да</option>
                <option value="0">Нет</option>
            </select>
        </label>
        <div id="trial-error" class="error"></div>

        <label>Дата устройства: <input type="date" id="hire_date"></label>
        <div id="hire-date-error" class="error"></div>

        <div style="margin-top:15px;">
            <button onclick="sendEmployee()">Сохранить</button>
            <button onclick="cancel()">Отмена</button>
        </div>
    </div>
</div>

<script>
function logoutUser() {
    fetch('/rgz/rest-api/logout', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success || data.message) {
            window.location.href = '/rgz';
        }
    })
    .catch(error => {
        console.error('Ошибка выхода:', error);
    });
}
</script>

{% endblock %}